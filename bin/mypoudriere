#!/bin/sh
set -e

jail=r140x64
emptdir="$HOME/src/empt/poudriere"
sivadir="$HOME/dotfiles/host_specific/xeon"

case $1 in
  xeon)
    pkgfile="$sivadir/poudriere-pkglist.txt"
    ;;
  cl100|wyse)
    pkgfile="$emptdir/empt-pkglist.txt"
    ;;
  *)
    >&2 echo "unsupported host: $1"
    >&2 echo "usage: $0 <host> <options|bulk>"
    exit 1
esac

if test ! -r "$pkgfile"; then
  >&2 echo "file not found: $pkgfile"
  exit 1
fi

case $2 in
  bulk|options)
    doas poudriere $2 -j "$jail" -p local -f "$pkgfile" -z "$1"
    ;;
  backup)
    cp -RP /usr/local/etc/poudriere.d/*-xeon-options "$sivadir/"
    cp -RP \
      /usr/local/etc/poudriere.d/*-cl100-options \
      /usr/local/etc/poudriere.d/*-wyse-options \
      "$emptdir/"
  *)
    >&2 echo "unsupported command: $2"
    exit 1
esac
